<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#128C7E">
    <meta name="apple-mobile-web-app-title" content="WhatsApp">
    <title>WhatsApp Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #111B21;
            color: #E9EDEF;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        .app-container {
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            background: #111B21;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* Header */
        .header {
            background: #202C33;
            color: #E9EDEF;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            min-height: 60px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #00A884;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: none;
        }

        .back-btn:active {
            background: rgba(255,255,255,0.1);
        }

        .header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00A884, #25D366);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
        }

        .header-info {
            flex: 1;
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .header-subtitle {
            font-size: 0.8rem;
            color: #8696A0;
        }

        .header-actions {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .header-btn {
            background: none;
            border: none;
            color: #8696A0;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .header-btn:active {
            background: rgba(255,255,255,0.1);
            color: #E9EDEF;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: #202C33;
            display: flex;
            border-bottom: 1px solid #2A3942;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            color: #8696A0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: #00A884;
            border-bottom-color: #00A884;
        }

        .tab-btn:active {
            background: rgba(255,255,255,0.05);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            display: none;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-content.active {
            display: block;
        }

        /* Chat List */
        .chat-list {
            background: #111B21;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            border-bottom: 1px solid #2A3942;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-item:active {
            background: #202C33;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00A884, #25D366);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .chat-name {
            font-weight: 500;
            font-size: 1rem;
            color: #E9EDEF;
        }

        .chat-time {
            font-size: 0.75rem;
            color: #8696A0;
        }

        .chat-preview {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .chat-last-message {
            font-size: 0.85rem;
            color: #8696A0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .unread-count {
            background: #00A884;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }

        .message-status {
            color: #53BDEB;
            font-size: 0.8rem;
            margin-right: 5px;
        }

        /* Chat Interface */
        .chat-interface {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #0B141A;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="%23ffffff" opacity="0.03"/></pattern></defs><rect x="0" y="0" width="100" height="100" fill="url(%23dots)"/></svg>');
        }

        .chat-interface.active {
            display: flex;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message {
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 8px;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            background: #005C4B;
            color: #E9EDEF;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .message.received {
            background: #202C33;
            color: #E9EDEF;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .message-content {
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .message-info {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
            font-size: 0.7rem;
            color: #8696A0;
        }

        .message-time {
            opacity: 0.8;
        }

        .message-status {
            color: #53BDEB;
        }

        /* Message Input */
        .message-input-container {
            background: #202C33;
            padding: 10px 20px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            border-top: 1px solid #2A3942;
        }

        .attachment-btn {
            background: none;
            border: none;
            color: #8696A0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            align-self: flex-end;
        }

        .attachment-btn:active {
            background: rgba(255,255,255,0.1);
        }

        .message-input {
            flex: 1;
            background: #2A3942;
            border: none;
            border-radius: 20px;
            padding: 12px 16px;
            color: #E9EDEF;
            font-size: 1rem;
            outline: none;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            font-family: inherit;
        }

        .message-input::placeholder {
            color: #8696A0;
        }

        .send-btn {
            background: #00A884;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-btn:active {
            background: #128C7E;
            transform: scale(0.95);
        }

        .voice-btn {
            background: #00A884;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .voice-btn:active {
            background: #128C7E;
            transform: scale(0.95);
        }

        /* Call Interface */
        .call-interface {
            display: none;
            flex-direction: column;
            height: 100%;
            background: linear-gradient(135deg, #1f3a5f 0%, #4a7c59 100%);
            position: relative;
            overflow: hidden;
        }

        .call-interface.active {
            display: flex;
        }

        .call-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,168,132,0.9) 0%, rgba(18,140,126,0.9) 100%);
            z-index: 1;
        }

        .call-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            z-index: 2;
            position: relative;
        }

        .call-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: #666;
            margin-bottom: 30px;
            border: 4px solid rgba(255,255,255,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .call-name {
            font-size: 1.8rem;
            font-weight: 300;
            color: white;
            margin-bottom: 10px;
            text-align: center;
        }

        .call-status {
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 40px;
            text-align: center;
        }

        .call-timer {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 20px;
        }

        .call-controls {
            display: flex;
            gap: 30px;
            align-items: center;
            justify-content: center;
            margin-top: auto;
            margin-bottom: 40px;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .call-btn:active {
            transform: scale(0.95);
        }

        .call-btn.mute {
            background: #54656F;
        }

        .call-btn.speaker {
            background: #54656F;
        }

        .call-btn.end {
            background: #E53E3E;
            width: 70px;
            height: 70px;
            font-size: 1.8rem;
        }

        .call-btn.answer {
            background: #00A884;
            width: 70px;
            height: 70px;
            font-size: 1.8rem;
        }

        .call-btn.video {
            background: #54656F;
        }

        /* Status List */
        .status-list {
            background: #111B21;
            padding: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            cursor: pointer;
        }

        .status-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00A884, #25D366);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            border: 3px solid #00A884;
        }

        .status-info {
            flex: 1;
        }

        .status-name {
            font-weight: 500;
            margin-bottom: 4px;
            color: #E9EDEF;
        }

        .status-time {
            font-size: 0.8rem;
            color: #8696A0;
        }

        /* Calls List */
        .calls-list {
            background: #111B21;
        }

        .call-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            border-bottom: 1px solid #2A3942;
            cursor: pointer;
        }

        .call-item:active {
            background: #202C33;
        }

        .call-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00A884, #25D366);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
        }

        .call-details {
            flex: 1;
        }

        .call-contact-name {
            font-weight: 500;
            margin-bottom: 4px;
            color: #E9EDEF;
        }

        .call-type {
            font-size: 0.8rem;
            color: #8696A0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .call-icon {
            font-size: 0.9rem;
        }

        .call-time-small {
            font-size: 0.75rem;
            color: #8696A0;
        }

        .call-action-btn {
            background: none;
            border: none;
            color: #00A884;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }

        .call-action-btn:active {
            background: rgba(255,255,255,0.1);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #00A884;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,168,132,0.4);
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:active {
            transform: scale(0.95);
            background: #128C7E;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            bottom: 120px;
        }

        /* Online Indicator */
        .online-indicator {
            width: 12px;
            height: 12px;
            background: #00A884;
            border-radius: 50%;
            border: 2px solid #111B21;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 8px 12px;
            background: #202C33;
            border-radius: 8px;
            align-self: flex-start;
            max-width: 85%;
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #8696A0;
            border-radius: 50%;
            animation: typing 1.5s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 20%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 375px) {
            .header {
                padding: 10px 15px;
            }
            
            .chat-item {
                padding: 10px 15px;
            }
            
            .message-input-container {
                padding: 8px 15px;
            }
            
            .call-controls {
                gap: 20px;
            }
        }

        /* Dark mode enhancements */
        .chat-item:hover {
            background: rgba(255,255,255,0.05);
        }

        /* Loading animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            font-size: 0.9rem;
            color: #8696A0;
        }

        /* Message animations */
        .message.new {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Voice recording indicator */
        .recording {
            background: #E53E3E !important;
            animation: recordPulse 1s infinite;
        }

        @keyframes recordPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Search bar */
        .search-container {
            padding: 10px 20px;
            background: #202C33;
            border-bottom: 1px solid #2A3942;
        }

        .search-input {
            width: 100%;
            background: #2A3942;
            border: none;
            border-radius: 20px;
            padding: 10px 16px;
            color: #E9EDEF;
            font-size: 0.9rem;
            outline: none;
        }

        .search-input::placeholder {
            color: #8696A0;
        }

        /* iOS safe area adjustments */
        @supports (-webkit-touch-callout: none) {
            .app-container {
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header" id="main-header">
            <div class="header-left">
                <button class="back-btn" id="back-btn" onclick="goBack()">‚Üê</button>
                <div class="header-avatar" onclick="showProfile()">üë§</div>
                <div class="header-info">
                    <div class="header-title" id="header-title">WhatsApp</div>
                    <div class="header-subtitle" id="header-subtitle"></div>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="search()">üîç</button>
                <button class="header-btn" onclick="showMenu()">‚ãÆ</button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation" id="tab-nav">
            <button class="tab-btn active" onclick="switchTab('chats')">CHATS</button>
            <button class="tab-btn" onclick="switchTab('status')">STATUS</button>
            <button class="tab-btn" onclick="switchTab('calls')">CALLS</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Chats Tab -->
            <div class="tab-content active" id="chats-tab">
                <div class="search-container" style="display: none;" id="search-container">
                    <input type="text" class="search-input" placeholder="Search or start new chat" oninput="searchChats(this.value)">
                </div>
                <div class="chat-list" id="chat-list">
                    <!-- Chat items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Status Tab -->
            <div class="tab-content" id="status-tab">
                <div class="status-list">
                    <div class="status-item" onclick="showToast('My Status - Add your status')">
                        <div class="status-avatar">üë§</div>
                        <div class="status-info">
                            <div class="status-name">My Status</div>
                            <div class="status-time">Tap to add status update</div>
                        </div>
                    </div>
                    <div style="padding: 20px 0 10px; color: #8696A0; font-size: 0.85rem; font-weight: 500;">
                        Recent updates
                    </div>
                    <div class="status-item" onclick="showToast('Viewed Sarah\'s status')">
                        <div class="status-avatar">üë©</div>
                        <div class="status-info">
                            <div class="status-name">Sarah Johnson</div>
                            <div class="status-time">Today, 2:30 PM</div>
                        </div>
                    </div>
                    <div class="status-item" onclick="showToast('Viewed Mike\'s status')">
                        <div class="status-avatar">üë®</div>
                        <div class="status-info">
                            <div class="status-name">Mike Chen</div>
                            <div class="status-time">Today, 1:15 PM</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calls Tab -->
            <div class="tab-content" id="calls-tab">
                <div class="calls-list" id="calls-list">
                    <!-- Call items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="chat-interface" id="chat-interface">
                <div class="chat-messages" id="chat-messages">
                    <!-- Messages will be populated by JavaScript -->
                </div>
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
                <div class="message-input-container">
                    <button class="attachment-btn" onclick="showAttachments()">üìé</button>
                    <textarea class="message-input" id="message-input" placeholder="Type a message" rows="1" oninput="handleInputChange()" onkeydown="handleKeyDown(event)"></textarea>
                    <button class="send-btn" id="send-btn" onclick="sendMessage()" style="display: none;">‚û§</button>
                    <button class="voice-btn" id="voice-btn" onclick="recordVoice()">üé§</button>
                </div>
            </div>

            <!-- Call Interface -->
            <div class="call-interface" id="call-interface">
                <div class="call-background"></div>
                <div class="call-content">
                    <div class="call-avatar" id="call-avatar">üë§</div>
                    <div class="call-name" id="call-name">Contact Name</div>
                    <div class="call-status" id="call-status">Calling...</div>
                    <div class="call-timer" id="call-timer" style="display: none;">00:00</div>
                    <div class="call-controls">
                        <button class="call-btn mute" id="mute-btn" onclick="toggleMute()">üîá</button>
                        <button class="call-btn speaker" id="speaker-btn" onclick="toggleSpeaker()">üîä</button>
                        <button class="call-btn end" onclick="endCall()">üìû</button>
                        <button class="call-btn video" id="video-btn" onclick="toggleVideo()">üìπ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button class="fab" id="fab" onclick="newChat()">üí¨</button>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // Global state
        let currentView = 'chats';
        let currentChat = null;
        let isInCall = false;
        let callStartTime = null;
        let callTimer = null;
        let isRecording = false;
        let isMuted = false;
        let isSpeakerOn = false;
        let isVideoOn = false;
        let isTyping = false;

        // Contacts database
        const contacts = [
            {
                id: 1,
                name: "Sarah Johnson",
                avatar: "üë©",
                phone: "+1234567890",
                online: true,
                lastSeen: "online"
            },
            {
                id: 2,
                name: "Mike Chen",
                avatar: "üë®",
                phone: "+1234567891",
                online: false,
                lastSeen: "last seen today at 2:30 PM"
            },
            {
                id: 3,
                name: "Emily Davis",
                avatar: "üë±‚Äç‚ôÄÔ∏è",
                phone: "+1234567892",
                online: true,
                lastSeen: "online"
            },
            {
                id: 4,
                name: "John Smith",
                avatar: "üë§",
                phone: "+1234567893",
                online: false,
                lastSeen: "last seen yesterday at 11:45 AM"
            },
            {
                id: 5,
                name: "Lisa Wang",
                avatar: "üë©‚Äçüíº",
                phone: "+1234567894",
                online: true,
                lastSeen: "online"
            },
            {
                id: 6,
                name: "David Brown",
                avatar: "üë®‚Äçüíª",
                phone: "+1234567895",
                online: false,
                lastSeen: "last seen today at 9:15 AM"
            }
        ];

        // Chat database
        const chats = [
            {
                id: 1,
                contactId: 1,
                lastMessage: "Hey! How are you doing?",
                timestamp: "10:30 AM",
                unreadCount: 2,
                messages: [
                    { id: 1, text: "Hi there!", sent: false, timestamp: "10:25 AM", status: "read" },
                    { id: 2, text: "Hey! How are you doing?", sent: false, timestamp: "10:30 AM", status: "delivered" }
                ]
            },
            {
                id: 2,
                contactId: 2,
                lastMessage: "Thanks for the help!",
                timestamp: "Yesterday",
                unreadCount: 0,
                messages: [
                    { id: 1, text: "Can you help me with this?", sent: true, timestamp: "2:15 PM", status: "read" },
                    { id: 2, text: "Sure, what do you need?", sent: false, timestamp: "2:20 PM", status: "read" },
                    { id: 3, text: "Thanks for the help!", sent: false, timestamp: "2:25 PM", status: "read" }
                ]
            },
            {
                id: 3,
                contactId: 3,
                lastMessage: "See you tomorrow!",
                timestamp: "Yesterday",
                unreadCount: 0,
                messages: [
                    { id: 1, text: "Meeting at 3 PM tomorrow?", sent: true, timestamp: "5:30 PM", status: "read" },
                    { id: 2, text: "Perfect! See you tomorrow!", sent: false, timestamp: "5:32 PM", status: "read" }
                ]
            },
            {
                id: 4,
                contactId: 4,
                lastMessage: "üëç",
                timestamp: "Monday",
                unreadCount: 0,
                messages: [
                    { id: 1, text: "Project completed successfully", sent: true, timestamp: "4:45 PM", status: "read" },
                    { id: 2, text: "üëç", sent: false, timestamp: "4:50 PM", status: "read" }
                ]
            },
            {
                id: 5,
                contactId: 5,
                lastMessage: "Coffee later?",
                timestamp: "Sunday",
                unreadCount: 1,
                messages: [
                    { id: 1, text: "Coffee later?", sent: false, timestamp: "11:20 AM", status: "delivered" }
                ]
            }
        ];

        // Call history
        const callHistory = [
            { id: 1, contactId: 1, type: "incoming", duration: "5:23", timestamp: "Today, 2:30 PM", missed: false },
            { id: 2, contactId: 2, type: "outgoing", duration: "1:45", timestamp: "Today, 11:15 AM", missed: false },
            { id: 3, contactId: 3, type: "incoming", duration: "", timestamp: "Yesterday, 6:45 PM", missed: true },
            { id: 4, contactId: 4, type: "outgoing", duration: "12:30", timestamp: "Yesterday, 3:20 PM", missed: false },
            { id: 5, contactId: 5, type: "incoming", duration: "3:45", timestamp: "Monday, 4:15 PM", missed: false }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadChats();
            loadCalls();
            setupAutoResize();
            
            // Add touch feedback
            document.addEventListener('touchstart', function() {}, { passive: true });
        });

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');

            currentView = tabName;
            updateFAB();
            resetHeader();
        }

        // Update FAB based on current tab
        function updateFAB() {
            const fab = document.getElementById('fab');
            const fabIcons = {
                'chats': 'üí¨',
                'status': 'üì∑',
                'calls': 'üìû'
            };
            fab.innerHTML = fabIcons[currentView] || 'üí¨';
        }

        // Load chats
        function loadChats() {
            const chatList = document.getElementById('chat-list');
            chatList.innerHTML = '';

            chats.forEach(chat => {
                const contact = contacts.find(c => c.id === chat.contactId);
                if (contact) {
                    const chatItem = createChatItem(chat, contact);
                    chatList.appendChild(chatItem);
                }
            });
        }

        // Create chat item
        function createChatItem(chat, contact) {
            const item = document.createElement('div');
            item.className = 'chat-item';
            item.onclick = () => openChat(chat.id);

            const isLastMessageSent = chat.messages.length > 0 && chat.messages[chat.messages.length - 1].sent;
            const statusIcon = isLastMessageSent ? '‚úì‚úì' : '';

            item.innerHTML = `
                <div class="chat-avatar" style="position: relative;">
                    ${contact.avatar}
                    ${contact.online ? '<div class="online-indicator"></div>' : ''}
                </div>
                <div class="chat-info">
                    <div class="chat-header">
                        <div class="chat-name">${contact.name}</div>
                        <div class="chat-time">${chat.timestamp}</div>
                    </div>
                    <div class="chat-preview">
                        <span class="message-status">${statusIcon}</span>
                        <div class="chat-last-message">${chat.lastMessage}</div>
                        ${chat.unreadCount > 0 ? `<div class="unread-count">${chat.unreadCount}</div>` : ''}
                    </div>
                </div>
            `;

            return item;
        }

        // Load calls
        function loadCalls() {
            const callsList = document.getElementById('calls-list');
            callsList.innerHTML = '';

            callHistory.forEach(call => {
                const contact = contacts.find(c => c.id === call.contactId);
                if (contact) {
                    const callItem = createCallItem(call, contact);
                    callsList.appendChild(callItem);
                }
            });
        }

        // Create call item
        function createCallItem(call, contact) {
            const item = document.createElement('div');
            item.className = 'call-item';

            const getCallIcon = () => {
                if (call.missed) return 'üìû';
                return call.type === 'incoming' ? 'üìû' : 'üìû';
            };

            const getCallColor = () => {
                if (call.missed) return '#E53E3E';
                return call.type === 'incoming' ? '#00A884' : '#8696A0';
            };

            item.innerHTML = `
                <div class="call-avatar-small">${contact.avatar}</div>
                <div class="call-details">
                    <div class="call-contact-name">${contact.name}</div>
                    <div class="call-type">
                        <span class="call-icon" style="color: ${getCallColor()}">${getCallIcon()}</span>
                        ${call.type === 'incoming' ? 'Incoming' : 'Outgoing'}${call.missed ? ' (missed)' : ''}
                        ${call.duration ? `, ${call.duration}` : ''}
                    </div>
                </div>
                <div class="call-time-small">${call.timestamp}</div>
                <button class="call-action-btn" onclick="event.stopPropagation(); makeCall(${contact.id}, 'voice')">üìû</button>
            `;

            return item;
        }

        // Open chat
        function openChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            const contact = contacts.find(c => c.id === chat.contactId);
            
            if (!chat || !contact) return;

            currentChat = chat;
            
            // Update header
            document.getElementById('header-title').textContent = contact.name;
            document.getElementById('header-subtitle').textContent = contact.lastSeen;
            document.getElementById('back-btn').style.display = 'block';
            document.getElementById('tab-nav').style.display = 'none';
            document.getElementById('fab').style.display = 'none';

            // Show chat interface
            document.getElementById('chats-tab').classList.remove('active');
            document.getElementById('chat-interface').classList.add('active');

            // Load messages
            loadMessages(chat);

            // Mark as read
            chat.unreadCount = 0;
            loadChats();

            // Simulate typing indicator
            setTimeout(() => {
                if (currentChat === chat) {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        if (Math.random() > 0.5) {
                            receiveMessage("That sounds great!");
                        }
                    }, 2000);
                }
            }, 3000);
        }

        // Load messages
        function loadMessages(chat) {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';

            chat.messages.forEach(message => {
                const messageElement = createMessageElement(message);
                messagesContainer.appendChild(messageElement);
            });

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Create message element
        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sent ? 'sent' : 'received'}`;

            const statusIcon = message.sent ? getStatusIcon(message.status) : '';

            messageDiv.innerHTML = `
                <div class="message-content">${message.text}</div>
                <div class="message-info">
                    <span class="message-time">${message.timestamp}</span>
                    ${message.sent ? `<span class="message-status">${statusIcon}</span>` : ''}
                </div>
            `;

            return messageDiv;
        }

        // Get status icon
        function getStatusIcon(status) {
            switch (status) {
                case 'sent': return '‚úì';
                case 'delivered': return '‚úì‚úì';
                case 'read': return '‚úì‚úì';
                default: return '';
            }
        }

        // Send message
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (text === '' || !currentChat) return;

            // Create new message
            const newMessage = {
                id: Date.now(),
                text: text,
                sent: true,
                timestamp: getCurrentTime(),
                status: 'sent'
            };

            // Add to chat
            currentChat.messages.push(newMessage);
            currentChat.lastMessage = text;
            currentChat.timestamp = getCurrentTime();

            // Update UI
            const messageElement = createMessageElement(newMessage);
            messageElement.classList.add('new');
            document.getElementById('chat-messages').appendChild(messageElement);

            // Clear input
            input.value = '';
            input.style.height = 'auto';
            toggleSendButton();

            // Scroll to bottom
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Update status to delivered after a delay
            setTimeout(() => {
                newMessage.status = 'delivered';
                const statusSpan = messageElement.querySelector('.message-status');
                if (statusSpan) {
                    statusSpan.textContent = getStatusIcon('delivered');
                }
            }, 1000);

            // Simulate read receipt
            setTimeout(() => {
                newMessage.status = 'read';
                const statusSpan = messageElement.querySelector('.message-status');
                if (statusSpan) {
                    statusSpan.textContent = getStatusIcon('read');
                    statusSpan.style.color = '#53BDEB';
                }
            }, 3000);

            // Trigger haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }

            // Refresh chat list
            loadChats();
        }

        // Receive message (simulation)
        function receiveMessage(text) {
            if (!currentChat) return;

            const newMessage = {
                id: Date.now(),
                text: text,
                sent: false,
                timestamp: getCurrentTime(),
                status: 'delivered'
            };

            currentChat.messages.push(newMessage);
            currentChat.lastMessage = text;
            currentChat.timestamp = getCurrentTime();

            const messageElement = createMessageElement(newMessage);
            messageElement.classList.add('new');
            document.getElementById('chat-messages').appendChild(messageElement);

            // Scroll to bottom
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Refresh chat list
            loadChats();

            // Play notification sound (simulated)
            showToast('üí¨ New message received');
        }

        // Handle input changes
        function handleInputChange() {
            const input = document.getElementById('message-input');
            const hasText = input.value.trim().length > 0;
            
            toggleSendButton();
            autoResize(input);

            // Show typing indicator to other user (simulated)
            if (hasText && !isTyping) {
                isTyping = true;
                // In real app, send typing indicator to other user
            } else if (!hasText && isTyping) {
                isTyping = false;
                // In real app, stop typing indicator
            }
        }

        // Handle key down events
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Toggle send button
        function toggleSendButton() {
            const input = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const voiceBtn = document.getElementById('voice-btn');
            const hasText = input.value.trim().length > 0;
            
            if (hasText) {
                sendBtn.style.display = 'flex';
                voiceBtn.style.display = 'none';
            } else {
                sendBtn.style.display = 'none';
                voiceBtn.style.display = 'flex';
            }
        }

        // Auto resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }

        // Setup auto resize
        function setupAutoResize() {
            const input = document.getElementById('message-input');
            input.addEventListener('input', () => autoResize(input));
        }

        // Show typing indicator
        function showTyping() {
            document.getElementById('typing-indicator').classList.add('active');
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Hide typing indicator
        function hideTyping() {
            document.getElementById('typing-indicator').classList.remove('active');
        }

        // Make call
        function makeCall(contactId, type = 'voice') {
            const contact = contacts.find(c => c.id === contactId);
            if (!contact) return;

            isInCall = true;
            callStartTime = Date.now();

            // Update call interface
            document.getElementById('call-avatar').textContent = contact.avatar;
            document.getElementById('call-name').textContent = contact.name;
            document.getElementById('call-status').textContent = 'Calling...';

            // Hide other interfaces
            document.querySelector('.tab-content.active')?.classList.remove('active');
            document.getElementById('chat-interface').classList.remove('active');
            document.getElementById('call-interface').classList.add('active');
            document.getElementById('tab-nav').style.display = 'none';
            document.getElementById('fab').style.display = 'none';

            // Update header
            document.getElementById('header-title').textContent = contact.name;
            document.getElementById('header-subtitle').textContent = type === 'video' ? 'Video calling...' : 'Voice calling...';
            document.getElementById('back-btn').style.display = 'none';

            // Simulate call connection
            setTimeout(() => {
                if (isInCall) {
                    document.getElementById('call-status').textContent = 'Connected';
                    document.getElementById('call-timer').style.display = 'block';
                    startCallTimer();
                }
            }, 3000);

            showToast(`üìû Calling ${contact.name}...`);
        }

        // Start call timer
        function startCallTimer() {
            const timerElement = document.getElementById('call-timer');
            
            callTimer = setInterval(() => {
                if (!isInCall) {
                    clearInterval(callTimer);
                    return;
                }

                const elapsed = Date.now() - callStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // End call
        function endCall() {
            isInCall = false;
            if (callTimer) {
                clearInterval(callTimer);
                callTimer = null;
            }

            // Reset call interface
            document.getElementById('call-interface').classList.remove('active');
            document.getElementById('call-timer').style.display = 'none';
            
            // Return to previous view
            goBack();
            
            showToast('üìû Call ended');
        }

        // Toggle mute
        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('mute-btn');
            btn.style.background = isMuted ? '#E53E3E' : '#54656F';
            btn.textContent = isMuted ? 'üîá' : 'üîä';
            showToast(isMuted ? 'üîá Muted' : 'üîä Unmuted');
        }

        // Toggle speaker
        function toggleSpeaker() {
            isSpeakerOn = !isSpeakerOn;
            const btn = document.getElementById('speaker-btn');
            btn.style.background = isSpeakerOn ? '#00A884' : '#54656F';
            showToast(isSpeakerOn ? 'üîä Speaker on' : 'üîä Speaker off');
        }

        // Toggle video
        function toggleVideo() {
            isVideoOn = !isVideoOn;
            const btn = document.getElementById('video-btn');
            btn.style.background = isVideoOn ? '#00A884' : '#54656F';
            btn.textContent = isVideoOn ? 'üìπ' : 'üìπ';
            showToast(isVideoOn ? 'üìπ Video on' : 'üìπ Video off');
        }

        // Record voice message
        function recordVoice() {
            if (!isRecording) {
                isRecording = true;
                const btn = document.getElementById('voice-btn');
                btn.classList.add('recording');
                btn.textContent = '‚èπ';
                showToast('üé§ Recording voice message...');
                
                // Simulate recording
                setTimeout(() => {
                    if (isRecording) {
                        stopRecording();
                    }
                }, 5000);
            } else {
                stopRecording();
            }
        }

        // Stop recording
        function stopRecording() {
            isRecording = false;
            const btn = document.getElementById('voice-btn');
            btn.classList.remove('recording');
            btn.textContent = 'üé§';
            
            if (currentChat) {
                receiveMessage('üé§ Voice message');
            }
            
            showToast('üé§ Voice message sent');
        }

        // Go back
        function goBack() {
            if (isInCall) {
                endCall();
                return;
            }

            if (currentChat) {
                currentChat = null;
                document.getElementById('chat-interface').classList.remove('active');
                document.getElementById('chats-tab').classList.add('active');
                resetHeader();
                document.getElementById('tab-nav').style.display = 'flex';
                document.getElementById('fab').style.display = 'flex';
            }
        }

        // Reset header
        function resetHeader() {
            document.getElementById('header-title').textContent = 'WhatsApp';
            document.getElementById('header-subtitle').textContent = '';
            document.getElementById('back-btn').style.display = 'none';
        }

        // New chat
        function newChat() {
            if (currentView === 'chats') {
                showToast('üí¨ Select a contact to start chatting');
            } else if (currentView === 'status') {
                showToast('üì∑ Add a status update');
            } else if (currentView === 'calls') {
                showToast('üìû Make a new call');
            }
        }

        // Utility functions
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours() % 12 || 12;
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            return `${hours}:${minutes} ${ampm}`;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Header functions
        function search() {
            const searchContainer = document.getElementById('search-container');
            if (searchContainer.style.display === 'none') {
                searchContainer.style.display = 'block';
                searchContainer.querySelector('input').focus();
            } else {
                searchContainer.style.display = 'none';
            }
        }

        function searchChats(query) {
            if (query.trim() === '') {
                loadChats();
                return;
            }

            const filteredChats = chats.filter(chat => {
                const contact = contacts.find(c => c.id === chat.contactId);
                return contact && contact.name.toLowerCase().includes(query.toLowerCase());
            });

            const chatList = document.getElementById('chat-list');
            chatList.innerHTML = '';

            filteredChats.forEach(chat => {
                const contact = contacts.find(c => c.id === chat.contactId);
                if (contact) {
                    const chatItem = createChatItem(chat, contact);
                    chatList.appendChild(chatItem);
                }
            });
        }

        function showMenu() {
            showToast('‚ãÆ Menu options');
        }

        function showProfile() {
            showToast('üë§ Profile settings');
        }

        function showAttachments() {
            showToast('üìé Attachment options');
        }

        // Handle back button
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                goBack();
            }
        });

        // Auto-respond simulation
        setInterval(() => {
            if (currentChat && Math.random() < 0.1) { // 10% chance every 10 seconds
                const responses = [
                    "How's your day going?",
                    "That's interesting!",
                    "I agree üëç",
                    "Let's catch up soon",
                    "Thanks for sharing",
                    "üòä",
                    "Sounds good!",
                    "I'll check it out"
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                setTimeout(() => {
                    receiveMessage(randomResponse);
                }, Math.random() * 3000);
            }
        }, 10000);

        // Initialize with welcome message
        setTimeout(() => {
            showToast('üí¨ Welcome to WhatsApp!');
        }, 1000);
    </script>
</body>
</html>
